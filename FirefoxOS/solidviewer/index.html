<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
	 "http://www.w3.org/TR/html4/strict.dtd">

<html>

<head>

	<meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7;" > 
	<meta http-equiv="content-type" content="text/html;charset=utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no">
	<link rel="stylesheet" type="text/css" href="include/style.css">
	<script type="text/javascript" src="include/three.min.js"></script>
	<script type="text/javascript" src="include/jsmodeler.js"></script>
	<script type="text/javascript" src="include/pagehandler.js"></script>
	<script type="text/javascript" src="include/menuhandler.js"></script>
	<title>Solid Viewer</title>

	<script type="text/javascript">
		var pageHandler = null;
		var menuHandler = null;
		var currentShape = null;
		
		var shapeParameters = {
			'cuboid' : {
				'x size' : {
					type : 'float',
					value : 1.0,
					min : 0.1,
					max : 10.0,
					step : 0.1
				},
				'y size' : {
					type : 'float',
					value : 1.0,
					min : 0.1,
					max : 10.0,
					step : 0.1
				},
				'z size' : {
					type : 'float',
					value : 1.0,
					min : 0.1,
					max : 10.0,
					step : 0.1
				}
			},
			'sphere' : {
				'segmentation' : {
					type : 'integer',
					value : 20,
					min : 3,
					max : 50,
					step : 1
				}
			},			
			'cylinder' : {
				'radius' : {
					type : 'float',
					value : 0.5,
					min : 0.1,
					max : 10.0,
					step : 0.1
				},
				'height' : {
					type : 'float',
					value : 1.0,
					min : 0.1,
					max : 10.0,
					step : 0.1
				},
				'segmentation' : {
					type : 'integer',
					value : 30,
					min : 3,
					max : 50,
					step : 1
				}
			},
			'cone' : {
				'top radius' : {
					type : 'float',
					value : 0.5,
					min : 0.0,
					max : 10.0,
					step : 0.1
				},
				'bottom radius' : {
					type : 'float',
					value : 0.8,
					min : 0.1,
					max : 10.0,
					step : 0.1
				},
				'height' : {
					type : 'float',
					value : 1.0,
					min : 0.1,
					max : 10.0,
					step : 0.1
				},
				'segmentation' : {
					type : 'integer',
					value : 30,
					min : 3,
					max : 50,
					step : 1
				}
			},
			'pie' : {
				'radius' : {
					type : 'float',
					value : 0.5,
					min : 0.1,
					max : 10.0,
					step : 0.1
				},
				'height' : {
					type : 'float',
					value : 0.1,
					min : 0.1,
					max : 10.0,
					step : 0.1
				},
				'angle' : {
					type : 'integer',
					value : 90,
					min : 1,
					max : 359,
					step : 1
				},
				'segmentation' : {
					type : 'integer',
					value : 30,
					min : 3,
					max : 50,
					step : 1
				}
			},
			'torus' : {
				'out radius' : {
					type : 'float',
					value : 0.5,
					min : 0.1,
					max : 10.0,
					step : 0.1
				},
				'in radius' : {
					type : 'float',
					value : 0.3,
					min : 0.1,
					max : 10.0,
					step : 0.1
				},
				'out segmentation' : {
					type : 'integer',
					value : 30,
					min : 3,
					max : 50,
					step : 1
				},
				'in segmentation' : {
					type : 'integer',
					value : 30,
					min : 3,
					max : 50,
					step : 1
				}
			},
			'platonic' : {
				'type' : {
					type : 'list',
					value : 'Tetrahedron',
					valueList : [
						'Tetrahedron',
						'Hexahedron',
						'Octahedron',
						'Dodecahedron',
						'Icosahedron'
					]
				}
			},
			'archimedean' : {
				'type' : {
					type : 'list',
					value : 'Truncated Tetrahedron',
					valueList : [
						'Truncated Tetrahedron',
						'Cuboctahedron',
						'Truncated Cube',
						'Truncated Octahedron',
						'Rhombicuboctahedron',
						'Truncated Cuboctahedron',
						'Snub Cube',
						'Icosidodecahedron',
						'Truncated Dodecahedron',
						'Truncated Icosahedron',
						'Rhombicosidodecahedron',
						'Truncated Icosidodecahedron',
						'Snub Dodecahedron'
					]
				}
			}			
		};
	
		function GenerateShape ()
		{
			var parameters = shapeParameters[currentShape];
			
			var body;
			if (currentShape == 'cuboid') {
				body = JSM.GenerateCuboid (parameters['x size'].value, parameters['y size'].value, parameters['z size'].value);
			} else if (currentShape == 'sphere') {
				body = JSM.GenerateSphere (1.0, parameters['segmentation'].value, true);
			} else if (currentShape == 'cylinder') {
				body = JSM.GenerateCylinder (parameters['radius'].value, parameters['height'].value, parameters['segmentation'].value, true, true);
			} else if (currentShape == 'cone') {
				body = JSM.GenerateCone (parameters['top radius'].value, parameters['bottom radius'].value, parameters['height'].value, parameters['segmentation'].value, true, true);
			} else if (currentShape == 'pie') {
				body = JSM.GeneratePie (parameters['radius'].value, parameters['height'].value, parameters['angle'].value * JSM.DegRad, parameters['segmentation'].value, true, true);
			} else if (currentShape == 'torus') {
				body = JSM.GenerateTorus (parameters['out radius'].value, parameters['in radius'].value, parameters['out segmentation'].value, parameters['in segmentation'].value, true);
			} else if (currentShape == 'platonic' || currentShape == 'archimedean') {
				var type = parameters.type.value.replace (' ', '');
				body = JSM.GenerateSolidWithRadius (type, 1.0);
			}
			
			var meshes = JSM.ConvertBodyToThreeMeshes (body);
			viewer.RemoveMeshes ();
			for (var i = 0; i < meshes.length; i++) {
				viewer.AddMesh (meshes[i]);
			}
			viewer.FitInWindow ();
		}
		
		function SetCurrentShape (shapeName)
		{
			currentShape = shapeName;
			var titleDiv = document.getElementById ('maintext');
			titleDiv.innerHTML = currentShape;

			pageHandler.SetToPage (0);
			Resize ();

			GenerateShape ();
		}

		function Back ()
		{
			pageHandler.SetToPage (0);
			Resize ();

			GenerateShape ();
		}
		
		function ShowSettings ()
		{
			pageHandler.SetToPage (1);
			Resize ();
			
			var content = document.getElementById ('settingscontent');
			var parameters = shapeParameters[currentShape];
			menuHandler.Init (content, parameters);
			menuHandler.Fill ();
		}
		
		function ShowMenu ()
		{
			pageHandler.SetToPage (2);
			Resize ();
		}

		function Resize ()
		{
			var page = pageHandler.GetPage ();
			var menus = document.getElementsByClassName ('menu');
			var contents = document.getElementsByClassName ('content');
			
			var menu = menus[page];
			var content = contents[page];
			content.style.width = window.innerWidth + 'px';
			content.style.height = (window.innerHeight - menu.clientHeight) + 'px';
			
			if (page == 0) {
				var canvas = document.getElementById ('viewer');
				canvas.setAttribute ('width', window.innerWidth);
				canvas.setAttribute ('height', window.innerHeight - menu.clientHeight);
				if (viewer != null) {
					viewer.Resize ();
					if (viewer.MeshCount () > 0) {
						viewer.FitInWindow ();
					}
				}
			}
		}

		function Load ()
		{
			pageHandler = new PageHandler ();
			pageHandler.SetToPage (0);
			
			menuHandler = new MenuHandler ();
			
			var TextureLoaded = function () {
				viewer.Draw ();
			};

			var viewerSettings = {
				cameraEyePosition : [-2.0, -1.5, 1.0],
				cameraCenterPosition : [0.0, 0.0, 0.0],
				cameraUpVector : [0, 0, 1],
				cameraDisableZoom : true
			};

			viewer = new JSM.Viewer ();
			viewer.Start ('viewer', viewerSettings);

			window.onresize = Resize;
			Resize ();
			
			currentShape = 'cuboid';
			GenerateShape ();
		}
	
	    window.onload = function ()
		{
			Load ();			
		}
	</script>

</head>

<body>
	<div class="page">
		<div class="menu" id="mainmenu">
			<div class="text" id="maintext">cuboid</div>
			<a href="javascript:ShowMenu ();"><div class="righticonbutton"><img src="images/menu.png"></div></a>
			<a href="javascript:ShowSettings ();"><div class="righticonbutton"><img src="images/settings.png"></div></a>
		</div>
		<div class="content">
			<canvas id="viewer" width="300" height="200"></canvas>
		</div>
	</div>

	<div class="page">
		<div class="menu">
			<div class="text">settings</div>
			<a href="javascript:Back ();"><div class="righticonbutton"><img src="images/back.png"></div></a>
		</div>
		<div class="content" id="settingscontent">
		</div>
	</div>

	<div class="page">
		<div class="menu">
			<div class="text">select</div>
			<a href="javascript:Back ();"><div class="righticonbutton"><img src="images/back.png"></div></a>
		</div>
		<div class="content">
			<a href="javascript:SetCurrentShape ('cuboid')"><div class="parameter">cuboid</div></a>
			<a href="javascript:SetCurrentShape ('sphere')"><div class="parameter">sphere</div></a>
			<a href="javascript:SetCurrentShape ('cylinder')"><div class="parameter">cylinder</div></a>
			<a href="javascript:SetCurrentShape ('cone')"><div class="parameter">cone</div></a>
			<a href="javascript:SetCurrentShape ('pie')"><div class="parameter">pie</div></a>
			<a href="javascript:SetCurrentShape ('torus')"><div class="parameter">torus</div></a>
			<a href="javascript:SetCurrentShape ('platonic')"><div class="parameter">platonic</div></a>
			<a href="javascript:SetCurrentShape ('archimedean')"><div class="parameter">archimedean</div></a>
		</div>
	</div>	
</body>

</html>
