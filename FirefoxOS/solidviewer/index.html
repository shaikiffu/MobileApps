<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
	 "http://www.w3.org/TR/html4/strict.dtd">

<html>

<head>

	<meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7;" > 
	<meta http-equiv="content-type" content="text/html;charset=utf-8">
	<link rel="stylesheet" type="text/css" href="include/style.css">
	<script type="text/javascript" src="include/three.min.js"></script>
	<script type="text/javascript" src="include/jsmodeler.js"></script>
	<script type="text/javascript" src="include/pagehandler.js"></script>
	<script type="text/javascript" src="include/menuhandler.js"></script>
	<title>Solid Viewer</title>

	<script type="text/javascript">
		var pageHandler = null;
		var menuHandler = null;
		var currentShape = null;
		
		var shapeParameters = [
			{ // cube
				'x size' : {
					type : 'float',
					value : 1.0,
					min : 0.1,
					max : 10.0,
					step : 0.1
				},
				'y size' : {
					type : 'float',
					value : 1.0,
					min : 0.1,
					max : 10.0,
					step : 0.1
				},
				'z size' : {
					type : 'float',
					value : 1.0,
					min : 0.1,
					max : 10.0,
					step : 0.1
				}
			}
		];
		
		function GenerateShape ()
		{
			var parameters = shapeParameters[currentShape];
			var body = JSM.GenerateCuboid (parameters['x size'].value, parameters['y size'].value, parameters['z size'].value);
			var meshes = JSM.ConvertBodyToThreeMeshes (body);
			
			viewer.RemoveMeshes ();
			for (var i = 0; i < meshes.length; i++) {
				viewer.AddMesh (meshes[i]);
			}
			viewer.FitInWindow ();
		}
		
		function Back ()
		{
			pageHandler.SetToPage (0);
			GenerateShape ();
			Resize ();
		}
		
		function ShowSettings ()
		{
			pageHandler.SetToPage (1);
			
			var content = document.getElementById ('settingscontent');
			var parameters = shapeParameters[currentShape];
			menuHandler.Init (content, parameters);
			menuHandler.Fill ();
		}
		
		function Resize ()
		{
			var menu = document.getElementById ('mainmenu');
			var canvas = document.getElementById ('viewer');
			canvas.setAttribute ('width', window.innerWidth);
			canvas.setAttribute ('height', window.innerHeight - menu.clientHeight);

			if (viewer != null) {
				viewer.Resize ();
				if (viewer.MeshCount () > 0) {
					viewer.FitInWindow ();
				}
			}
		}

		function Load ()
		{
			pageHandler = new PageHandler ();
			pageHandler.SetToPage (0);
			
			menuHandler = new MenuHandler ();
			
			var TextureLoaded = function () {
				viewer.Draw ();
			};

			var viewerSettings = {
				cameraEyePosition : [-2.0, -1.5, 1.0],
				cameraCenterPosition : [0.0, 0.0, 0.0],
				cameraUpVector : [0, 0, 1]
			};

			viewer = new JSM.Viewer ();
			viewer.Start ('viewer', viewerSettings);

			window.onresize = Resize;
			Resize ();
			
			currentShape = 0;
			GenerateShape ();
		}
	
	    window.onload = function ()
		{
			Load ();			
		}
	</script>

</head>

<body>
	<div class="page">
		<div class="menu" id="mainmenu">
			<div class="text">solids</div>
			<div class="righticonbutton"><img src="images/menu.png"></div>
			<a href="javascript:ShowSettings ();"><div class="righticonbutton"><img src="images/settings.png"></div></a>
		</div>
		<canvas id="viewer" width="300" height="200"></canvas>
	</div>

	<div class="page">
		<div class="menu">
			<a href="javascript:Back ();"><div class="lefticonbutton"><img src="images/back.png"></div></a>
			<div class="text">settings</div>
		</div>
		<div class="clearer"></div>
		<div class="content" id="settingscontent">
		</div>
	</div>
</body>

</html>
